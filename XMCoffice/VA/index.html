<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XMC工作室 - 视频解析工具</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 119, 198, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            z-index: -1;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            position: relative;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
            position: relative;
            overflow: hidden;
        }
        
        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            z-index: -1;
        }
        
        .header {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #64b3f4, #c2e59c);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
            margin-top: 5px;
        }
        
        .input-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .input-container {
            display: flex;
            width: 100%;
            gap: 12px;
        }
        
        .input-wrapper {
            flex: 1;
            position: relative;
        }
        
        .url-input {
            width: 100%;
            padding: 18px 100px 18px 18px;
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .url-input:focus {
            outline: none;
            border-color: rgba(100, 179, 244, 0.6);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 20px rgba(100, 179, 244, 0.2);
        }
        
        .url-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .clear-btn {
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.1rem;
            cursor: pointer;
            padding: 5px;
            transition: color 0.3s;
            z-index: 2;
        }
        
        .clear-btn:hover {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .parse-btn {
            padding: 0 30px;
            background: linear-gradient(90deg, #4a6fa5, #64b3f4);
            border: none;
            color: white;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(100, 179, 244, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .parse-btn:hover {
            background: linear-gradient(90deg, #64b3f4, #4a6fa5);
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(100, 179, 244, 0.4);
        }
        
        .parse-btn:active {
            transform: scale(0.98);
        }
        
        .parse-btn:disabled {
            background: linear-gradient(90deg, #555, #777);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .request-type {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .request-btn {
            padding: 10px 18px;
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .request-btn.active {
            background: rgba(100, 179, 244, 0.2);
            border-color: rgba(100, 179, 244, 0.5);
            color: #64b3f4;
        }
        
        .request-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
        }
        
        .content-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }
        
        .loading.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .spinner {
            width: 45px;
            height: 45px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: #64b3f4;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        .messages {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .error-message {
            background: rgba(244, 67, 54, 0.1);
            border-left: 4px solid #f44336;
            padding: 12px;
            border-radius: 8px;
            display: none;
            font-size: 0.95rem;
        }
        
        .error-message.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .success-message {
            background: rgba(76, 175, 80, 0.1);
            border-left: 4px solid #4CAF50;
            padding: 12px;
            border-radius: 8px;
            display: none;
            font-size: 0.95rem;
        }
        
        .success-message.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .video-section {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }
        
        .video-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .image-section {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }
        
        .image-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .media-info {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .media-title {
            font-size: 1.3rem;
            margin-bottom: 8px;
            color: #fff;
            line-height: 1.4;
        }
        
        .media-meta {
            display: flex;
            gap: 15px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }
        
        .video-container {
            width: 100%;
            margin-bottom: 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .video-player {
            width: 100%;
            display: block;
            background: #000;
        }
        
        .images-container {
            margin-bottom: 20px;
        }
        
        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .image-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            height: 160px;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        
        .image-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .image-index {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.75rem;
        }
        
        .image-count {
            margin-top: 10px;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            font-size: 0.85rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            flex: 1;
            min-width: 160px;
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .download-btn {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            color: white;
        }
        
        .download-btn:hover {
            background: linear-gradient(90deg, #8BC34A, #4CAF50);
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(139, 195, 74, 0.3);
        }
        
        .instructions {
            margin-top: 10px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }
        
        .instructions h3 {
            color: #64b3f4;
            margin-bottom: 12px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .instructions ul {
            list-style: none;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.5;
            font-size: 0.9rem;
        }
        
        .instructions li {
            margin-bottom: 6px;
            padding-left: 20px;
            position: relative;
        }
        
        .instructions li:before {
            content: "•";
            color: #64b3f4;
            position: absolute;
            left: 0;
        }
        
        .footer {
            margin-top: 20px;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.85rem;
            padding: 15px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 移动端优化 */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
                gap: 20px;
            }
            
            .glass-card {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .input-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .url-input {
                padding: 16px 90px 16px 16px;
                font-size: 0.95rem;
            }
            
            .parse-btn {
                padding: 16px 20px;
                font-size: 0.95rem;
                justify-content: center;
            }
            
            .clear-btn {
                font-size: 1rem;
                right: 12px;
            }
            
            .action-btn {
                min-width: 100%;
            }
            
            .video-section, .image-section, .instructions {
                padding: 18px;
            }
            
            .images-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 10px;
            }
            
            .image-item {
                height: 140px;
            }
            
            .media-meta {
                flex-direction: column;
                gap: 4px;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.7rem;
            }
            
            .url-input {
                padding: 14px 80px 14px 14px;
            }
            
            .parse-btn {
                padding: 14px 18px;
                font-size: 0.9rem;
            }
            
            .media-meta {
                flex-direction: column;
                gap: 3px;
            }
            
            .clear-btn {
                font-size: 0.95rem;
                right: 10px;
            }
            
            .images-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
                gap: 8px;
            }
            
            .image-item {
                height: 120px;
            }
            
            .request-btn {
                padding: 8px 14px;
                font-size: 0.85rem;
            }
        }
        
        @media (min-width: 769px) {
            .images-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }
            
            .image-item {
                height: 180px;
            }
        }
        
        @media (min-width: 481px) and (max-width: 768px) {
            .images-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 12px;
            }
            
            .image-item {
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-film"></i> 视频解析工具</h1>
        </div>
        
        <div class="glass-card">
            <div class="input-section">
                <div class="request-type">
                    <div class="request-btn active" id="autoBtn">
                        <i class="fas fa-robot"></i> 自动选择
                    </div>
                    <div class="request-btn" id="getBtn">GET 请求</div>
                    <div class="request-btn" id="postBtn">POST 请求</div>
                </div>
                
                <div class="input-container">
                    <div class="input-wrapper">
                        <input type="text" id="urlInput" class="url-input" placeholder="请输入视频或图片链接（例如：快手、抖音等平台链接）">
                        <button id="clearBtn" class="clear-btn" title="清空输入框">
                            <i class="fas fa-times-circle"></i>
                        </button>
                    </div>
                    <button id="parseBtn" class="parse-btn">
                        <i class="fas fa-play-circle"></i> 解析内容
                    </button>
                </div>
            </div>
            
            <div class="content-area">
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>正在解析内容，请稍候...</p>
                </div>
                
                <div class="messages">
                    <div class="error-message" id="errorMessage"></div>
                    <div class="success-message" id="successMessage"></div>
                </div>
                
                <div class="video-section" id="videoSection">
                    <div class="media-info">
                        <h2 class="media-title" id="videoTitle"></h2>
                        <div class="media-meta">
                            <span id="videoAuthor"></span>
                            <span id="videoPlatform"></span>
                            <span id="mediaType">类型：视频</span>
                        </div>
                    </div>
                    
                    <div class="video-container">
                        <video id="videoPlayer" class="video-player" controls></video>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="downloadBtn" class="action-btn download-btn">
                            <i class="fas fa-download"></i> 下载视频
                        </button>
                    </div>
                </div>
                
                <div class="image-section" id="imageSection">
                    <div class="media-info">
                        <h2 class="media-title" id="imageTitle"></h2>
                        <div class="media-meta">
                            <span id="imageAuthor"></span>
                            <span id="imagePlatform"></span>
                            <span id="imageType">类型：图片</span>
                        </div>
                    </div>
                    
                    <div class="images-container">
                        <div class="images-grid" id="imagesGrid"></div>
                        <div class="image-count" id="imageCount"></div>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="downloadImageBtn" class="action-btn download-btn">
                            <i class="fas fa-download"></i> 下载全部图片
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> 使用说明</h3>
                <ul>
                    <li>支持抖音、快手、小红书、B站等平台的视频和图片解析</li>
                    <li>如果无法正常解析，请去掉链接中的文字再试</li>
                </ul>
            </div>
        </div>
        
        <div class="footer">
            <p>XMC工作室 - 视频解析工具<br>Copyright &copy; 2024-2026 XMC工作室</p>
        </div>
    </div>

    <script>
        const urlInput = document.getElementById('urlInput');
        const clearBtn = document.getElementById('clearBtn');
        const parseBtn = document.getElementById('parseBtn');
        const autoBtn = document.getElementById('autoBtn');
        const getBtn = document.getElementById('getBtn');
        const postBtn = document.getElementById('postBtn');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const videoSection = document.getElementById('videoSection');
        const imageSection = document.getElementById('imageSection');
        const videoPlayer = document.getElementById('videoPlayer');
        const videoTitle = document.getElementById('videoTitle');
        const videoAuthor = document.getElementById('videoAuthor');
        const videoPlatform = document.getElementById('videoPlatform');
        const imageTitle = document.getElementById('imageTitle');
        const imageAuthor = document.getElementById('imageAuthor');
        const imagePlatform = document.getElementById('imagePlatform');
        const imagesGrid = document.getElementById('imagesGrid');
        const imageCount = document.getElementById('imageCount');
        const downloadBtn = document.getElementById('downloadBtn');
        const downloadImageBtn = document.getElementById('downloadImageBtn');
        
        let currentMediaData = null;
        let requestMode = 'auto'; // 'auto', 'get', 'post'
        let currentImages = [];
        
        // 初始化：设置自动模式为默认
        autoBtn.classList.add('active');
        getBtn.classList.remove('active');
        postBtn.classList.remove('active');
        
        // 自动模式：根据链接特征选择请求方式
        function detectRequestType(url) {
            if (requestMode !== 'auto') return requestMode;
            
            const urlStr = url.toLowerCase();
            
            // 抖音链接通常使用GET
            if (urlStr.includes('douyin') || urlStr.includes('iesdouyin')) {
                return 'GET';
            }
            
            // 快手链接
            if (urlStr.includes('kuaishou') || urlStr.includes('gifshow')) {
                return 'GET';
            }
            
            // 小红书链接
            if (urlStr.includes('xiaohongshu') || urlStr.includes('redbook')) {
                return 'POST';
            }
            
            // B站链接
            if (urlStr.includes('bilibili') || urlStr.includes('b23.tv')) {
                return 'GET';
            }
            
            // 默认使用GET
            return 'GET';
        }
        
        autoBtn.addEventListener('click', () => {
            requestMode = 'auto';
            autoBtn.classList.add('active');
            getBtn.classList.remove('active');
            postBtn.classList.remove('active');
        });
        
        getBtn.addEventListener('click', () => {
            requestMode = 'get';
            getBtn.classList.add('active');
            autoBtn.classList.remove('active');
            postBtn.classList.remove('active');
        });
        
        postBtn.addEventListener('click', () => {
            requestMode = 'post';
            postBtn.classList.add('active');
            autoBtn.classList.remove('active');
            getBtn.classList.remove('active');
        });
        
        clearBtn.addEventListener('click', () => {
            urlInput.value = '';
            urlInput.focus();
        });
        
        parseBtn.addEventListener('click', async () => {
            const mediaUrl = urlInput.value.trim();
            
            if (!mediaUrl) {
                showError('请输入视频或图片链接');
                return;
            }
            
            showLoading(true);
            hideMessages();
            hideVideoSection();
            hideImageSection();
            
            try {
                let response;
                const requestType = detectRequestType(mediaUrl);
                
                if (requestType === 'GET') {
                    response = await fetchWithGet(mediaUrl);
                } else {
                    response = await fetchWithPost(mediaUrl);
                }
                
                if (response && response.success) {
                    showSuccess('解析成功！');
                    currentMediaData = response.data;
                    
                    if (currentMediaData.type === 1) {
                        displayVideo(currentMediaData);
                    } else if (currentMediaData.type === 2) {
                        displayImages(currentMediaData);
                    } else {
                        showError('未知的内容类型：' + currentMediaData.type);
                    }
                } else {
                    showError(response ? response.message || '解析失败' : '解析失败，无响应数据');
                }
            } catch (error) {
                showError('解析失败：' + error.message);
                console.error('解析错误:', error);
            } finally {
                showLoading(false);
            }
        });
        
        async function fetchWithGet(mediaUrl) {
            const encodedUrl = encodeURIComponent(mediaUrl);
            const apiUrl = `http://api.yxo82519.icu/spjx/index.php?url=${encodedUrl}`;
            
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 15000);
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    },
                    mode: 'cors',
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP错误: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                clearTimeout(timeoutId);
                if (error.name === 'AbortError') {
                    throw new Error('请求超时，请稍后重试');
                }
                throw error;
            }
        }
        
        async function fetchWithPost(mediaUrl) {
            const apiUrl = `http://api.yxo82519.icu/spjx/index.php?url=`;
            
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 15000);
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({ url: mediaUrl }),
                    mode: 'cors',
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP错误: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                clearTimeout(timeoutId);
                if (error.name === 'AbortError') {
                    throw new Error('请求超时，请稍后重试');
                }
                throw error;
            }
        }
        
        function displayVideo(mediaData) {
            videoTitle.textContent = mediaData.title || '无标题';
            videoAuthor.textContent = `作者：${mediaData.nickName || '未知'}`;
            videoPlatform.textContent = `平台：${mediaData.platform || '未知'}`;
            
            if (mediaData.videoUrl) {
                videoPlayer.src = mediaData.videoUrl;
                videoSection.classList.add('active');
                videoPlayer.load();
            } else {
                showError('视频链接无效，无法播放');
            }
        }
        
        function displayImages(mediaData) {
            imageTitle.textContent = mediaData.title || '无标题';
            imageAuthor.textContent = `作者：${mediaData.nickName || '未知'}`;
            imagePlatform.textContent = `平台：${mediaData.platform || '未知'}`;
            
            imagesGrid.innerHTML = '';
            currentImages = mediaData.imageList || [];
            
            if (currentImages.length === 0) {
                imagesGrid.innerHTML = '<p style="color: rgba(255,255,255,0.7); text-align: center; width: 100%;">没有找到图片</p>';
                imageCount.textContent = '';
            } else {
                currentImages.forEach((imgUrl, index) => {
                    const imgItem = document.createElement('div');
                    imgItem.className = 'image-item';
                    imgItem.dataset.index = index;
                    imgItem.innerHTML = `
                        <img src="${imgUrl}" alt="图片 ${index + 1}" loading="lazy">
                        <div class="image-index">${index + 1}</div>
                    `;
                    
                    imagesGrid.appendChild(imgItem);
                });
                
                imageCount.textContent = `共 ${currentImages.length} 张图片`;
            }
            
            imageSection.classList.add('active');
        }
        
        downloadBtn.addEventListener('click', () => {
            if (currentMediaData && currentMediaData.videoUrl) {
                const link = document.createElement('a');
                link.href = currentMediaData.videoUrl;
                
                const title = currentMediaData.title || 'video';
                const cleanTitle = title.replace(/[^\w\u4e00-\u9fa5]/g, '_').substring(0, 30);
                link.download = `${cleanTitle}.mp4`;
                link.target = '_blank';
                link.style.display = 'none';
                document.body.appendChild(link);
                
                try {
                    link.click();
                    
                    setTimeout(() => {
                        document.body.removeChild(link);
                        showSuccess('视频下载已开始，如果未自动下载，请检查浏览器设置或尝试右键链接另存为。');
                    }, 1000);
                } catch (error) {
                    document.body.removeChild(link);
                    
                    try {
                        window.open(currentMediaData.videoUrl, '_blank');
                        showSuccess('无法直接下载，已在浏览器中打开视频，请右键另存为');
                    } catch (openError) {
                        showError('下载失败：' + error.message);
                    }
                }
            } else {
                showError('无法下载：视频链接无效');
            }
        });
        
        downloadImageBtn.addEventListener('click', async () => {
            if (currentImages.length === 0) {
                showError('没有图片可下载');
                return;
            }
            
            showSuccess(`开始下载 ${currentImages.length} 张图片...`);
            
            let successCount = 0;
            let failCount = 0;
            
            for (let i = 0; i < currentImages.length; i++) {
                const imgUrl = currentImages[i];
                const fileName = getImageFileName(i);
                
                try {
                    const link = document.createElement('a');
                    link.href = imgUrl;
                    link.download = fileName;
                    link.target = '_blank';
                    link.style.display = 'none';
                    document.body.appendChild(link);
                    link.click();
                    
                    setTimeout(() => {
                        document.body.removeChild(link);
                    }, 100);
                    
                    successCount++;
                    
                    // 添加短暂延迟，避免同时下载过多文件
                    if (i < currentImages.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 300));
                    }
                } catch (error) {
                    console.error(`下载第 ${i + 1} 张图片失败:`, error);
                    failCount++;
                }
            }
            
            if (failCount === 0) {
                showSuccess(`成功下载 ${successCount} 张图片`);
            } else if (successCount > 0) {
                showSuccess(`成功下载 ${successCount} 张图片，${failCount} 张图片下载失败`);
            } else {
                showError('所有图片下载失败，请检查网络连接或图片链接');
            }
        });
        
        function getImageFileName(index) {
            const title = currentMediaData.title || 'image';
            const cleanTitle = title.replace(/[^\w\u4e00-\u9fa5]/g, '_').substring(0, 30);
            return `${cleanTitle}_${index + 1}.jpg`;
        }
        
        function showLoading(show) {
            if (show) {
                loading.classList.add('active');
                parseBtn.disabled = true;
            } else {
                loading.classList.remove('active');
                parseBtn.disabled = false;
            }
        }
        
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('active');
            successMessage.classList.remove('active');
        }
        
        function showSuccess(message) {
            successMessage.textContent = message;
            successMessage.classList.add('active');
            errorMessage.classList.remove('active');
        }
        
        function hideMessages() {
            errorMessage.classList.remove('active');
            successMessage.classList.remove('active');
        }
        
        function hideVideoSection() {
            videoSection.classList.remove('active');
        }
        
        function hideImageSection() {
            imageSection.classList.remove('active');
        }
        
        urlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                parseBtn.click();
            }
        });
        
    </script>
</body>
</html>
